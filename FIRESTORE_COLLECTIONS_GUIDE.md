# Firestore Collections Setup Guide

This guide will help you create all the Firestore collections and fields that match your TellBarangay app.

## üìã Table of Contents
1. [Users Collection](#1-users-collection)
2. [Reports Collection](#2-reports-collection)
3. [Requests Collection](#3-requests-collection)
4. [Announcements Collection](#4-announcements-collection)
5. [Notifications Collection](#5-notifications-collection)
6. [Step-by-Step Setup Instructions](#step-by-step-setup-instructions)

---

## 1. Users Collection

**Collection Name:** `users`

**Document ID:** Firebase Auth UID (automatically generated)

**Fields:**

| Field Name | Type | Required | Description | Example |
|------------|------|----------|------------|---------|
| `uid` | string | ‚úÖ Yes | Firebase Auth User ID | "abc123xyz" |
| `name` | string | ‚úÖ Yes | Full name of user | "Juan Dela Cruz" |
| `email` | string | ‚úÖ Yes | Email address | "juan@example.com" |
| `username` | string | ‚úÖ Yes | Unique username | "juandelacruz" |
| `role` | string | ‚úÖ Yes | User role: "citizen" or "official" | "citizen" |
| `position` | string | ‚ùå No | Official position (for officials only) | "Barangay Captain" |
| `address` | string | ‚ùå No | User's address | "123 Main St, Purok 5" |
| `contact` | string | ‚ùå No | Contact number | "+63 912 345 6789" |
| `barangay` | string | ‚ùå No | Barangay name | "Barangay Poblacion" |
| `age` | string | ‚ùå No | User's age | "25" |
| `createdAt` | timestamp | ‚úÖ Yes | Account creation date | Auto-generated |
| `updatedAt` | timestamp | ‚úÖ Yes | Last update date | Auto-generated |

**Index Required:** 
- Create index on `username` field (for uniqueness checking)

---

## 2. Reports Collection

**Collection Name:** `reports`

**Document ID:** Auto-generated by Firestore

**Fields:**

| Field Name | Type | Required | Description | Example |
|------------|------|----------|------------|---------|
| `reportId` | string | ‚úÖ Yes | Report ID (same as document ID) | "RPT-1234567890" |
| `title` | string | ‚úÖ Yes | Report title | "Uncollected garbage" |
| `description` | string | ‚úÖ Yes | Detailed description | "Garbage not collected for 3 days..." |
| `category` | string | ‚úÖ Yes | Report category | "Garbage", "Noise", "Water", "Safety", "Road Damage", "Illegal Activities", "Other" |
| `photos` | array | ‚úÖ Yes | Array of photo URLs | ["https://...", "https://..."] |
| `status` | string | ‚úÖ Yes | Report status | "Pending", "In Progress", "Solved" |
| `createdBy` | string | ‚úÖ Yes | UID of user who created report | "abc123xyz" |
| `createdAt` | timestamp | ‚úÖ Yes | Report creation date | Auto-generated |
| `updatedAt` | timestamp | ‚úÖ Yes | Last update date | Auto-generated |

**Indexes Required:**
- Composite index: `createdBy` (ascending) + `createdAt` (descending)
- Index: `createdAt` (descending)

---

## 3. Requests Collection

**Collection Name:** `requests`

**Document ID:** Auto-generated by Firestore

**Fields:**

| Field Name | Type | Required | Description | Example |
|------------|------|----------|------------|---------|
| `requestId` | string | ‚úÖ Yes | Request ID (same as document ID) | "REQ-1234567890" |
| `type` | string | ‚úÖ Yes | Request type | "Barangay Certificate", "Barangay ID", "Clearance", "Indigency Certificate", "Business Permit", "Other" |
| `purpose` | string | ‚úÖ Yes | Purpose of request | "For employment" |
| `fullName` | string | ‚úÖ Yes | Full name of requester | "Juan Dela Cruz" |
| `proofUrl` | string | ‚úÖ Yes | URL of proof document image | "https://..." |
| `status` | string | ‚úÖ Yes | Request status | "Pending", "Approved", "Rejected" |
| `createdBy` | string | ‚úÖ Yes | UID of user who created request | "abc123xyz" |
| `createdAt` | timestamp | ‚úÖ Yes | Request creation date | Auto-generated |
| `updatedAt` | timestamp | ‚úÖ Yes | Last update date | Auto-generated |

**Indexes Required:**
- Composite index: `createdBy` (ascending) + `createdAt` (descending)
- Index: `createdAt` (descending)

---

## 4. Announcements Collection

**Collection Name:** `announcements`

**Document ID:** Auto-generated by Firestore

**Fields:**

| Field Name | Type | Required | Description | Example |
|------------|------|----------|------------|---------|
| `announcementId` | string | ‚úÖ Yes | Announcement ID (same as document ID) | "ANN-1234567890" |
| `title` | string | ‚úÖ Yes | Announcement title | "Community Meeting" |
| `body` | string | ‚úÖ Yes | Announcement content | "We will have a meeting..." |
| `createdBy` | string | ‚úÖ Yes | UID of official who created it | "abc123xyz" |
| `createdAt` | timestamp | ‚úÖ Yes | Announcement creation date | Auto-generated |

**Index Required:**
- Index: `createdAt` (descending)

---

## 5. Notifications Collection

**Collection Name:** `notifications`

**Document ID:** Auto-generated by Firestore

**Fields:**

| Field Name | Type | Required | Description | Example |
|------------|------|----------|------------|---------|
| `notificationId` | string | ‚úÖ Yes | Notification ID (same as document ID) | "NOT-1234567890" |
| `toUid` | string | ‚úÖ Yes | UID of user receiving notification | "abc123xyz" |
| `message` | string | ‚úÖ Yes | Notification message | "Your report has been solved..." |
| `type` | string | ‚úÖ Yes | Notification type | "report_update", "request_update" |
| `read` | boolean | ‚úÖ Yes | Whether notification is read | false |
| `createdAt` | timestamp | ‚úÖ Yes | Notification creation date | Auto-generated |

**Indexes Required:**
- Composite index: `toUid` (ascending) + `createdAt` (descending)

---

## Step-by-Step Setup Instructions

### Step 1: Create Firestore Database

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project "TellBarangay App"
3. Click **"Firestore Database"** in the left sidebar
4. Click **"Create database"**
5. Choose **"Start in test mode"** (for development)
6. Select your preferred location
7. Click **"Enable"**

### Step 2: Create Collections Manually (Optional - They'll be created automatically)

**Note:** Collections will be created automatically when your app writes data. However, you can create them manually to see the structure:

#### Create Users Collection:
1. In Firestore Database, click **"+ Start collection"**
2. Collection ID: `users`
3. Click **"Next"**
4. Document ID: Click **"Auto-ID"** (or use a test UID)
5. Add fields one by one:
   - Field: `uid`, Type: `string`, Value: `test123`
   - Field: `name`, Type: `string`, Value: `Test User`
   - Field: `email`, Type: `string`, Value: `test@example.com`
   - Field: `username`, Type: `string`, Value: `testuser`
   - Field: `role`, Type: `string`, Value: `citizen`
   - Field: `position`, Type: `string`, Value: `` (empty)
   - Field: `address`, Type: `string`, Value: `` (empty)
   - Field: `contact`, Type: `string`, Value: `` (empty)
   - Field: `barangay`, Type: `string`, Value: `` (empty)
   - Field: `age`, Type: `string`, Value: `` (empty)
   - Field: `createdAt`, Type: `timestamp`, Value: Click **"Set to current time"**
   - Field: `updatedAt`, Type: `timestamp`, Value: Click **"Set to current time"`
6. Click **"Save"**

#### Create Reports Collection:
1. Click **"+ Start collection"**
2. Collection ID: `reports`
3. Click **"Next"**
4. Document ID: **"Auto-ID"**
5. Add fields:
   - `reportId`: string, `RPT-123`
   - `title`: string, `Test Report`
   - `description`: string, `Test description`
   - `category`: string, `Garbage`
   - `photos`: array, `[]` (empty array)
   - `status`: string, `Pending`
   - `createdBy`: string, `test123`
   - `createdAt`: timestamp, current time
   - `updatedAt`: timestamp, current time
6. Click **"Save"**

#### Create Requests Collection:
1. Click **"+ Start collection"**
2. Collection ID: `requests`
3. Click **"Next"**
4. Document ID: **"Auto-ID"**
5. Add fields:
   - `requestId`: string, `REQ-123`
   - `type`: string, `Barangay Certificate`
   - `purpose`: string, `For employment`
   - `fullName`: string, `Test User`
   - `proofUrl`: string, `https://example.com/proof.jpg`
   - `status`: string, `Pending`
   - `createdBy`: string, `test123`
   - `createdAt`: timestamp, current time
   - `updatedAt`: timestamp, current time
6. Click **"Save"**

#### Create Announcements Collection:
1. Click **"+ Start collection"**
2. Collection ID: `announcements`
3. Click **"Next"**
4. Document ID: **"Auto-ID"**
5. Add fields:
   - `announcementId`: string, `ANN-123`
   - `title`: string, `Test Announcement`
   - `body`: string, `Test announcement body`
   - `createdBy`: string, `test123`
   - `createdAt`: timestamp, current time
6. Click **"Save"**

#### Create Notifications Collection:
1. Click **"+ Start collection"**
2. Collection ID: `notifications`
3. Click **"Next"**
4. Document ID: **"Auto-ID"**
5. Add fields:
   - `notificationId`: string, `NOT-123`
   - `toUid`: string, `test123`
   - `message`: string, `Test notification`
   - `type`: string, `report_update`
   - `read`: boolean, `false`
   - `createdAt`: timestamp, current time
6. Click **"Save"**

### Step 3: Create Indexes

Firestore will prompt you to create indexes when needed. However, you can create them manually:

1. Go to Firestore Database ‚Üí **"Indexes"** tab
2. Click **"Create Index"**

**Create these indexes:**

#### Index 1: Users - Username lookup
- Collection ID: `users`
- Fields to index:
  - `username` (Ascending)
- Query scope: Collection
- Click **"Create"**

#### Index 2: Reports - User reports
- Collection ID: `reports`
- Fields to index:
  - `createdBy` (Ascending)
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

#### Index 3: Reports - All reports by date
- Collection ID: `reports`
- Fields to index:
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

#### Index 4: Requests - User requests
- Collection ID: `requests`
- Fields to index:
  - `createdBy` (Ascending)
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

#### Index 5: Requests - All requests by date
- Collection ID: `requests`
- Fields to index:
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

#### Index 6: Announcements - By date
- Collection ID: `announcements`
- Fields to index:
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

#### Index 7: Notifications - User notifications
- Collection ID: `notifications`
- Fields to index:
  - `toUid` (Ascending)
  - `createdAt` (Descending)
- Query scope: Collection
- Click **"Create"**

### Step 4: Set Up Security Rules

Go to **"Rules"** tab and use the rules from `FIREBASE_SETUP.md`:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }
    
    // Reports collection
    match /reports/{reportId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.createdBy == request.auth.uid || 
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'official');
    }
    
    // Requests collection
    match /requests/{requestId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.createdBy == request.auth.uid || 
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'official');
    }
    
    // Announcements collection
    match /announcements/{announcementId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'official';
    }
    
    // Notifications collection
    match /notifications/{notificationId} {
      allow read: if request.auth != null && 
        resource.data.toUid == request.auth.uid;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        resource.data.toUid == request.auth.uid;
    }
  }
}
```

Click **"Publish"** to save the rules.

### Step 5: Test Your Setup

1. **Run your Flutter app**: `flutter run`
2. **Register a new user** - This will create a document in the `users` collection
3. **Submit a report** - This will create a document in the `reports` collection
4. **Submit a request** - This will create a document in the `requests` collection
5. **Check Firebase Console** - Go to Firestore Database ‚Üí Data tab to see your data

---

## üìù Important Notes

1. **Collections are created automatically** - You don't need to manually create them. They'll be created when your app writes data.

2. **Document IDs** - Most collections use auto-generated IDs. The `users` collection uses Firebase Auth UID as the document ID.

3. **Timestamps** - Use `FieldValue.serverTimestamp()` in your code, which will show as "Server Timestamp" in Firebase Console.

4. **Arrays** - The `photos` field in reports is an array. In Firebase Console, you'll see it as `[value1, value2]`.

5. **Indexes** - Firestore will prompt you to create indexes when you run queries that need them. You can create them from the error message link.

6. **Security Rules** - Make sure to update security rules before going to production!

---

## üîç Verifying Your Setup

After setting up, verify by:

1. **Register a user** ‚Üí Check `users` collection
2. **Login** ‚Üí Should work if user exists
3. **Submit report** ‚Üí Check `reports` collection
4. **Submit request** ‚Üí Check `requests` collection
5. **Create announcement** (as official) ‚Üí Check `announcements` collection
6. **Update report status** (as official) ‚Üí Check `notifications` collection

All data should appear in Firebase Console under Firestore Database ‚Üí Data tab!


